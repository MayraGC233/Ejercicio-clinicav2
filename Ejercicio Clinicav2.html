<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Clínica Médica - App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">

  <!-- Portada con imagen -->
  <header class="w-full relative">
    <img src="https://raw.githubusercontent.com/MayraGC233/Ejercicio-clinicav2/main/clinica.jpg" 
         alt="Clínica Médica" 
         class="w-full h-64 object-cover">
    <div class="absolute inset-0 bg-black bg-opacity-40 flex flex-col justify-center items-center text-white">
      <h1 class="text-3xl font-bold">Clínica Médica</h1>
      <p class="text-lg">Ginecología • Obstetricia • Pediatría</p>
    </div>
  </header>

  <!-- Menú de navegación -->
  <nav class="bg-blue-600 w-full flex justify-center space-x-4 p-3 text-white font-semibold">
    <button onclick="mostrarSeccion('pacientes')">Pacientes</button>
    <button onclick="mostrarSeccion('consultas')">Consultas</button>
    <button onclick="mostrarSeccion('citas')">Citas</button>
    <button onclick="mostrarSeccion('resumen')">📊 Resumen</button>
  </nav>

  <main class="p-6 w-full max-w-3xl space-y-6">

    <!-- Formularios -->
    <section id="pacientes" class="seccion hidden">
      <h2 class="text-xl font-bold mb-2">Registro de Pacientes</h2>
      <form class="formulario bg-white p-4 rounded shadow" data-tipo="Pacientes">
        <div class="mb-2">
          <label class="block">Nombre completo:</label>
          <input type="text" name="nombre" class="border p-2 w-full rounded" required>
        </div>
        <div class="mb-2">
          <label class="block">Edad:</label>
          <input type="number" name="edad" class="border p-2 w-full rounded" required>
        </div>
        <div class="mb-2">
          <label class="block">Especialidad:</label>
          <select name="especialidad" class="border p-2 w-full rounded" required>
            <option disabled selected>Seleccionar</option>
            <option>Ginecología</option>
            <option>Obstetricia</option>
            <option>Pediatría</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="block">🚨 Nivel de urgencia:</label>
          <select name="urgencia" class="border p-2 w-full rounded" required>
            <option disabled selected>Seleccionar</option>
            <option>Bajo</option>
            <option>Moderado</option>
            <option>Alto</option>
          </select>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
      </form>
      <div class="mensaje mt-2"></div>
    </section>

    <section id="consultas" class="seccion hidden">
      <h2 class="text-xl font-bold mb-2">Registro de Consultas</h2>
      <form class="formulario bg-white p-4 rounded shadow" data-tipo="Consultas">
        <div class="mb-2">
          <label class="block">Número de paciente:</label>
          <input type="text" name="idPaciente" class="border p-2 w-full rounded" required>
        </div>
        <div class="mb-2">
          <label class="block">Diagnóstico:</label>
          <textarea name="diagnostico" class="border p-2 w-full rounded" required></textarea>
        </div>
        <div class="mb-2">
          <label class="block">Tratamiento:</label>
          <textarea name="tratamiento" class="border p-2 w-full rounded" required></textarea>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
      </form>
      <div class="mensaje mt-2"></div>
    </section>

    <section id="citas" class="seccion hidden">
      <h2 class="text-xl font-bold mb-2">Registro de Citas</h2>
      <form class="formulario bg-white p-4 rounded shadow" data-tipo="Citas">
        <div class="mb-2">
          <label class="block">Número de paciente:</label>
          <input type="text" name="idPaciente" class="border p-2 w-full rounded" required>
        </div>
        <div class="mb-2">
          <label class="block">Fecha:</label>
          <input type="date" name="fecha" class="border p-2 w-full rounded" required>
        </div>
        <div class="mb-2">
          <label class="block">Hora:</label>
          <input type="time" name="hora" class="border p-2 w-full rounded" required>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded">Guardar</button>
      </form>
      <div class="mensaje mt-2"></div>
    </section>

    <!-- Resumen -->
    <section id="resumen" class="seccion hidden">
      <h2 class="text-xl font-bold mb-2">📊 Resumen General</h2>
      <div id="tablaResumen" class="overflow-x-auto bg-white rounded shadow p-4"></div>
    </section>
  </main>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyRVqoyyOEA0tV84z5tirsNnMXrxXoky6_iE0vgxSbnljesDMo7acjIw33qMwZYvCnM/exec";

    // Navegación
    function mostrarSeccion(id) {
      document.querySelectorAll(".seccion").forEach(s => s.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      if (id === "resumen") cargarResumen();
    }

    // Formularios
    document.querySelectorAll(".formulario").forEach(form => {
      form.addEventListener("submit", e => {
        e.preventDefault();
        const tipo = form.dataset.tipo;
        const data = Object.fromEntries(new FormData(form).entries());
        data.tipo = tipo;

        fetch(scriptURL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.json())
        .then(resp => {
          form.nextElementSibling.textContent = "✅ " + resp.message;
          form.reset();
        })
        .catch(err => {
          form.nextElementSibling.textContent = "❌ Error: " + err.message;
        });
      });
    });

    // Resumen
    function cargarResumen() {
      fetch(scriptURL + "?action=read")
        .then(res => res.json())
        .then(data => {
          if (!data.length) {
            document.getElementById("tablaResumen").innerHTML = "<p>No hay registros.</p>";
            return;
          }
          const headers = Object.keys(data[0]);
          let html = "<table class='table-auto w-full border'><thead><tr>";
          headers.forEach(h => html += `<th class='border px-2 py-1'>${h}</th>`);
          html += "</tr></thead><tbody>";
          data.forEach(row => {
            html += "<tr>";
            headers.forEach(h => html += `<td class='border px-2 py-1'>${row[h] || ""}</td>`);
            html += "</tr>";
          });
          html += "</tbody></table>";
          document.getElementById("tablaResumen").innerHTML = html;
        });
    }

    // Mostrar sección por defecto
    mostrarSeccion("pacientes");
  </script>
</body>
</html>
